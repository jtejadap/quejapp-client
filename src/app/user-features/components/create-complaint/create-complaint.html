<navigation-bar></navigation-bar>

<div class="max-w-3xl mx-auto p-6">
  <h1 class="text-3xl font-bold text-orange-600 text-center mb-6">Nueva Solicitud</h1>

  <form [formGroup]="complaintForm" (ngSubmit)="createComplaint()"
    class="bg-white shadow-lg rounded-xl p-6 space-y-6 border border-gray-200">


    <!-- Tipo de solicitud con Radio Cards -->
    <div>
      <p class="font-semibold text-gray-700 mb-4">Tipo de solicitud:</p>
      <radio-card [options]="typeOptions" formControlName="type">
      </radio-card>

      @if (type?.invalid && (type?.dirty || type?.touched)) {
      <div class="text-red-500 text-sm mt-2">
        @if (type?.hasError('required')) {
        <div>Este campo es obligatorio.</div>
        }
      </div>
      }
    </div>

    <!-- Categoria -->
    <div>
      <label for="category" class="block text-gray-700 font-medium mb-1">Categoría:</label>
      <select id="category" formControlName="category" required
        class="w-full border border-gray-300 rounded-lg p-2 focus:ring-orange-500 focus:border-orange-500">
        @for (item of categoryOptions; track item.value) {
        <option [value]="item.value">{{ item.label }}</option>
        }
      </select>
      @if (category?.invalid && (category?.dirty || category?.touched)) {
      <div class="text-red-500 text-sm mt-1">
        @if (category?.hasError('required')) {
        <div>Este campo es obligatorio.</div>
        }
      </div>
      }
    </div>

    <!-- Asunto -->
    <div>
      <label for="subject" class="block text-gray-700 font-medium mb-1">Asunto:</label>
      <input id="subject" type="text" formControlName="subject" maxlength="101" required
        class="w-full border border-gray-300 rounded-lg p-2 focus:ring-orange-500 focus:border-orange-500" />
      @if (subject?.invalid && (subject?.dirty || subject?.touched)) {
      <div class="text-red-500 text-sm mt-1">
        @if (subject?.hasError('required')) {
        <div>Este campo es obligatorio.</div>
        }
        @if (subject?.hasError('maxlength')) {
        <div>El asunto debe tener máximo 100 caracteres.</div>
        }
      </div>
      }
    </div>

    <!-- Descripción -->
    <div>
      <label for="description" class="block text-gray-700 font-medium mb-1">Descripción:</label>
      <textarea id="description" rows="4" formControlName="description" maxlength="801" required
        class="w-full border border-gray-300 rounded-lg p-2 focus:ring-orange-500 focus:border-orange-500"></textarea>
      @if (description?.invalid && (description?.dirty || description?.touched)) {
      <div class="text-red-500 text-sm mt-1">
        @if (description?.hasError('required')) {
        <div>Este campo es obligatorio.</div>
        }
        @if (description?.hasError('maxlength')) {
        <div>La descripción debe tener máximo 800 caracteres.</div>
        }
      </div>
      }
    </div>

    <!-- Error global -->
    @if (errorMessage) {
    <div class="text-red-600 text-sm bg-red-100 p-2 rounded-md">
      {{ errorMessage }}
    </div>
    }

    <div class="flex justify-between items-center mt-6">
      <!-- Botón Volver -->
      <a routerLink="/user"
        class="bg-white border border-orange-600 text-orange-600 font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-orange-50 transition">
        Volver
      </a>

      <!-- Botón Enviar -->
      <button type="submit" [disabled]="!complaintForm.valid"
        class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md disabled:opacity-50 disabled:cursor-not-allowed transition">
        Enviar
      </button>
    </div>
  </form>
</div>